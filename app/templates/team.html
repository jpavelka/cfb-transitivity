{% extends "layout.html" %}
{% block head %}
<script>
    var paths = {{ paths | tojson | safe }}
    var logos = {{ logos | tojson | safe }}
    function onLoadFunc() {
        populateTeamDropdown(document.getElementById("winLossSelect").value);
    }
    function populateTeamDropdown(result) {
        var teamSelect = document.getElementById("opponentSelect");
        var current_team = teamSelect.value;
        teamSelect.options.length = 0;
        if (!(current_team in paths[result])) {
            var opt = document.createElement('option');
            opt.selected = true;
            opt.disabled = true;
            opt.value = null;
            opt.innerHTML = "-- select an opponent --";
            teamSelect.appendChild(opt);
        }
        for (var team in paths[result]) {
            var opt = document.createElement('option');
            opt.value = team;
            opt.innerHTML = team;
            if (team == current_team) {
                opt.selected = true;
            }
            teamSelect.appendChild(opt);
        }
        if (current_team in paths[result]) {
            renderPath(current_team);
        }
        else {
            var pathDisplay = document.getElementById("pathDisplay");
            pathDisplay.innerHTML = ''
        }
    }
    function logoAndTeam(team, logo, pixels) {
        beforeImage = '<table style="display: inline-table;"><tbody><tr><td align="center">';
        image = '<img height="' + pixels + 'px" src="' + logo + '">';
        afterImage = '</td></tr><tr><td align="center">' + team + '</td></tr></tbody></table>';
        return beforeImage + image + afterImage;
    }
    function renderPath(team) {
        var result = document.getElementById("winLossSelect").value;
        var pathDisplay = document.getElementById("pathDisplay");
        pathDisplay.innerHTML = ''
        var path = paths[result][team];
        for (var t in path) {
            if (t < path.length - 1) {
                arrow = '<span class="glyphicon glyphicon-arrow-right" style="font-size:30px;min-height:50px;line-height:50px"></span>';
            }
            else {
                arrow = ''
            }
            pathDisplay.innerHTML += '&nbsp' + logoAndTeam(path[t], logos[path[t]], 50) + arrow + '&nbsp';
        }
    }
</script>
{% endblock %}
{% block title %}Transitive Property Report{% endblock %}
{% block body %}
    <h1>Transitive Property Report for {{ team }}</h1>
    <div class="row">
        <div class="col-xs-12">
            Choose another team:
            <select onchange="window.location.href = this.value">
                <option selected disabled>-- select a team --</option>
                {% for t in all_teams %}
                    <option value="{{ all_team_urls[t] }}">{{ t }}</option>
                {% endfor %}
            </select>
            or return to the <a href="/">rankings page</a>
        </div>
    </div>
    <h2>Path visualizer</h2>
    <div class="row">
        <div class="col-xs-4">
            <select id="winLossSelect" onchange="populateTeamDropdown(this.value)">
                <option value="victories">Win</option>
                <option value="defeats">Loss</option>
            </select>
            <select id="opponentSelect" onchange="renderPath(this.value)"></select>
        </div>
        <div class="col-xs-8"></div>
    </div>
    <div class="row">
        <div class="col-xs-12" id="pathDisplay"></div>
    </div>
    <h2>Statistics</h2>
    <div class="row"><div class="col-xs-12 col-sm-10 col-md-8 col-lg-6"><div class="row">
        <div class="col-xs-4"><table class="table"><tbody>
            <tr><td>Win Rank</td><td>{{ '%.0f' % rank_info['win_rank'] }}</td></tr>
            <tr><td>Transitive Wins</td><td>{{ '%.0f' % rank_info['trans_wins'] }}</td></tr>
            <tr><td>Avg Win Length</td><td>{{ '%.2f' % rank_info['avg_win_len'] }}</td></tr>
        </tbody></table></div>
        <div class="col-xs-4"><table class="table"><tbody>
            <tr><td>Loss Rank</td><td>{{ '%.0f' % rank_info['loss_rank'] }}</td></tr>
            <tr><td>Transitive Losses</td><td>{{ '%.0f' % rank_info['trans_losses'] }}</td></tr>
            <tr><td>Avg Loss Length</td><td>{{ '%.2f' % rank_info['avg_loss_len'] }}</td></tr>
        </tbody></table></div>
        <div class="col-xs-4"><table class="table"><tbody>
            <tr><td>Overall Rank</td><td>{{ '%.0f' % rank_info['comb_rank'] }}</td></tr>
            <tr><td>Win/Loss Rank Avg</td><td>{{ '%.2f' % rank_info['avg_rank'] }}</td></tr>
        </tbody></table></div>
    </div></div></div>
    <div class="row">
        {% for result in levels %}
            <div class="col-xs-12 col-md-6">
                <h2>Transitive {{ result }} ({{ paths[result]|length }})</h2>
                <table class="table"><tbody>
                    {% if levels[result]|length == 0 %}
                        {{ team }} has no transitive {{ result }}
                    {% else %}
                        {% for i in range(levels[result]|length) %}
                            <tr>
                                <td>Level {{ i + 1 }} {{ result }} ({{ levels[result][i + 1]|length }})</td>
                                <td>
                                    {% for t in levels[result][i + 1] %}
                                        {{ t }}{{ "," if not loop.last }}
                                    {% endfor %}
                                </td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                </tbody></table>
            </div>
        {% endfor %}
    </div>
{% endblock %}
